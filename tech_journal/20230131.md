
# Chick-Fil-A : Enterprise Restaurant Compute

- 각 레스토랑에 엣지 쿠버네티스 클러스터로 운영중
- 각 매장의 모든 기기들은 IoT 텔레메트리 정보를 지속적으로 제공. 수만대의 기기들이 연결되어 있음.
- 이런 정보들로부터 실시간 수요 예측 - 클라우드 쪽으로 보내서 분석 프로세스가 실행됨
- 내부 조리 과정과 모바일 페이먼트 터미널 등까지 모두 통합

### Resautrant Edge Compute platform

- 현재의 많은 시스템들은 클라우드/데이터센터에 맞춰져 있음
- 리소스 제한적이고 인터넷 커넥션도 좋지 않은 환경. 그리고 수천개의 쿠버네티스 클러스터에는 적합하지 않음
- 그래서 직접 만들기로 결정.

### 하드웨어

- 일반 소비자용 Intel NUC 사용
- NUC 세대를 묶어서 3노트 클러스터를 생성. 안정성, 용량, HA 설정까지 대응하도록 유연하게


### OS

- 첫 번째 릴리즈에는 Ubuntu를 기본 OS로 사용
- 디자인 목표는 그냥 NUC를 레스토랑에 드랍쉬핑만 하는 것. 
- 즉, 모든 프로비저닝은 동적으로 on-the-fly로 동작
  - provisioning : 사용자의 요구에 맞게 시스템 자원을 할당, 배치, 배포해두었다가 필요시 시스템을 즉시 사용할 수 있는 상태로 미리 준비해두는 것.
- 물론 몇개의 보안 기능으로 다른 기기들이 클러스터에 조인하거나 내부 클라우드 서비스에 접근하는 것은 막음


### Edge Commander

- 클러스터 부트스트래핑 및 관리 프로세스
- 각 엣지 클러스터 노드는 동일한 이미지로 구축
- 여러개의 디스크 파티션 및 OverlayFS를 이용한 트릭도 포함
  - 특정 데이터를 롱텀으로 유지하거나 노드의 다른 파티션들을 원격으로 삭제하는 기능 등


### Kubernetes

- K3s 구현체를 사용하기로 결정
  - 쿠버네티스 스펙과 호환하지만 일부 기능을 제거. 대규모로 설정 및 지원하는 것이 매우 간단함
- *클라우드를 사용하는게 아니므로* 쿠버네티스 전체 기능을 필요로 하지 않음
- 매우 만족하고 앞으로도 바꿀 일 없음. (오~)


### GitOps

- 첫번째 플랫폼 릴리즈 구축할때에는 리소스 제한적인 엣지에서 실행 가능한 GitOps 에이전트 솔루션이 없었음.
- 그래서 'Vessel'이라 부르는 자체 에이전트를 개발
- Git Repo를 폴링하고 클러스터 변경 사항을 처리
- 클라우드의 쿠버네티스 클러스터에 오픈소스 Gitlab 인스턴스를 호스팅중
- 직접 Git 서버를 운영하는 부담은 가지고 싶지 않았으나 비용 효율적인 호스팅 솔루션 라이센스 모델을 찾을 수 없었음.


### Deployments

- GitOps를 위해 각 지점이 자신의 Git Repo를 지정 (Atlas라고 부름)
- 각 레스토랑에 새로운 배포는 Atlas의 마스터 브랜치에 새로운 설정을 머지하는 것으로 가능
- 이 접근법은 엔터프라이즈 관리에는 약간의 트레이드 오프가 있지만 배포 상태 관리 및 감사를 매우 간단하게 만들어줬음

### Supporting a Chain-Wide Deployment

- 가장 큰 도전은 MVP에서 매우 작은 팀이 유지 가능하면서도 스케일러블하고 지원이 가능한 플랫폼으로 바꾼 것

### API First 전략

- 비즈니스의 첫번째 순서는 모든 수동 프로세스 및 유효성 검사 단계를 RESTful API로 래핑하는 것
- 각 단계에 대한 포괄적인 API Suite를 만든 다음, 맨 위에 오케스트레이션 계층을 구축해서 수동 프로세스들을 자동화하기 시작
- 포괄적이고 잘 문서화된 PostMan 프로젝트를 생성함으로써 새로운 API를 신속하게 활용하고 지원팀용 Web UI를 만드는 것을 지연시킬 수 있었음.
- OAuth를 활용해서 API Suite에 대한 세분화된 단계별 접근을 제공. 특정 기능을 쉽게 잠그거나 고객들에게 non-invasive한 상태 및 보고 엔드포인트를 열어줄 수 있었음.

### Dedicated Roll Out Team

- 어떻게 짧은 시간에 수많은 기기들을 각 체인에 배포할 수 있었을까?
- 핵심 개발팀은 매우 작아서 플랫폼 지원 및 개발부터 체인 전체 롤아웃을 배포까지 지원하기는 어려웠었음.
- 

