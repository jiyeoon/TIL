## 스파크의 전역 범위 vs. 지역 범위

스파크에서 병렬처리를할 때 두가지 모드로 동작할 수 있다. 첫째는 클러스터 모드이며 두번째는 로컬 모드이다. 스파크가 로컬 모드로 동작할때는 파이썬을 실행시키는 것과 다르지 않을 수 있다.

골치 아픈 일이 많이 생기는 것은 바로 클러스터 모드인데, 먼저 어떻게 스파크가 클러스터에서 job 을 실행시키는지 이해할 필요가 있다.

클러스터 모드에서 잡이 실행되면, 그 잡은 드라이버 노드 (또는 마스터 노드)로 보내진다.

드라이버 노드는 잡을 위해 DAG를 생성하고 어떤 실행 노드(또는 워커 노드)가 특정 태스크를 실행할지 결정한다. 그리고 드라이버는 각 태스크를 마칠 준비를 한 후 워커 노드가 각자의 태스크를 수행하고 작업을 마치면 그 결과를 드라이버 노드에 리턴하도록 한다. 

이 변수와 함수는 내부적으로 실행 노드의 문맥사에서 정적이다. 즉, 각자의 실행 노드가 드라이버 노드에서 사용되는 변수와 함수를 복사해 사용한다. 태스크를 실행할 때, 실행노드가 이 변수나 함수를 수정할 경우 다른 실행 노드들의 변수나 함수에는 영향을 주지 않는다는 것이다. 이로 인해 런타임 버그나 몇몇 이상행위를 유발할 수 있는데, 보통 이러한 오류들은 굉장히 추적하기가 힘들다.
